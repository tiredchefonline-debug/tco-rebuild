(function(){ function closest(el, selector){ while (el && el.nodeType === 1){ if (el.matches(selector)) return el; el = el.parentElement; } return null; } function closeAll(){ document.querySelectorAll('.dropdown.open').forEach(d=>d.classList.remove('open')); } function openDropdown(trigger){ const dd = closest(trigger, '.dropdown'); const nav = document.querySelector('.header .nav') || document.querySelector('.nav') || document.body; if (!dd) return; dd.classList.add('open'); const menu = dd.querySelector('.menu'); if (!menu) return; const trigRect = trigger.getBoundingClientRect(); const navRect = nav.getBoundingClientRect(); const gap = 10; const left = trigRect.left - navRect.left; const top = trigRect.bottom - navRect.top + gap; menu.style.left = Math.max(8, Math.round(left)) + 'px'; menu.style.top = Math.max(8, Math.round(top)) + 'px'; } document.addEventListener('click', (e)=>{ const t = e.target.closest('[data-dropdown]'); if (!t){ closeAll(); return; } e.preventDefault(); const wasOpen = t.closest('.dropdown')?.classList.contains('open'); closeAll(); if (!wasOpen) openDropdown(t); }); document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeAll(); }); window.addEventListener('resize', closeAll, {passive:true}); window.addEventListener('scroll', closeAll, {passive:true}); })();